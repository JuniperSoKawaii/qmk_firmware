# Настройка среды QMK

Перед тем, как вы сможете собирать раскладки, вам необходимо установить определённое программное обеспечение и настроить среду для сборки. Это нужно сделать только один раз, вне зависимости от того, для скольких клавиатур вы планируете компилировать прошивки.

## 1. Загрузка ПО

### Текстовый редактор

Вам понадобится программа, умеющая редактировать и сохранять **обычные текстовые** файлы. Если вы используете Windows, вы можете делать это Блокнотом, а в Linux вы можете использовать gedit. Обе программы являются простыми, но функциональными редакторами. В macOS остерегайтесь стандартного приложения TextEdit: он не будет сохранять обычные текстовые файлы, пока вы явно не выберите _Make Plain Text_ из меню _Format_.

Вы также можете скачать и установить отдельный текстовый редактор, например [Sublime Text](https://www.sublimetext.com/) или [VS Code](https://code.visualstudio.com/). Возможно, это наилучший вариант независимо от платформы, поскольку эти программы сделаны специально для редактирования кода.

?> Не уверены, какой выбрать текстовый редактор? Лоуренс Брэдфорд (Laurence Bradford) написал [отличное введение](https://learntocodewith.me/programming/basics/text-editors/) в тему.

### QMK Toolbox

QMK Toolbox является дополнительной графической программой для Windows и macOS, которая позволяет вам разрабатывать и отлаживать вашу клавиатуру. Вы, вероятно, посчитаете ее бесценной для легкого процесса прошивки вашей клавиатуры и просмотра выводимых отладочных сообщений.

[Скачайте последнюю версию](https://github.com/qmk/qmk_toolbox/releases/latest)

* Для Windows: `qmk_toolbox.exe` (переносимое приложение) или `qmk_toolbox_install.exe` (установщик)
* Для macOS: `QMK.Toolbox.app.zip` (переносимое приложение) или `QMK.Toolbox.pkg` (установщик)

### Unix-подобная среда

В Linux и macOS уже есть готовая оболочка unix. Вам останется лишь настроить среду для сборки.

В случае Windows сначала необходимо установить MSYS2 или WSL и продолжить работу в одной из этих сред. Ниже приведена инструкция по настройке MSYS2.

## 2. Подготовка среды для сборки :id=set-up-your-environment
Мы постарались сделать установку QMK максимально легкой. Вам нужно только подготовить ваше Linux или Unix окружение, после этого позвольте QMK установить всё остальное.

?> Если вы никогда раньше не работали с командной строкой Linux/Unix, существует несколько базовых концептов и команд, которые необходимо выучить. Эти ресурсы дадут вам достаточно знаний, чтобы работать с QMK:<br>
[Обязательные к изучению команды Linux](https://www.guru99.com/must-know-linux-commands.html)<br>
[Несколько базовых команд Unix](https://www.tjhsst.edu/~dhyatt/superap/unixcmd.html)

### Windows

Вам нужно будет установить MSYS2, Git и QMK CLI.

Следуйте инструкциям по установки на [домашней странице MSYS2](https://www.msys2.org). Закройте все открытые терминалы MSYS2 и откройте новый терминал MSYS2 MinGW 64-bit. **Внимание: Это *не* тот терминал MSYS, который открывается после завершения установки.**

Затем выполните следующие команды:

    pacman --needed --noconfirm --disable-download-timeout -S git mingw-w64-x86_64-toolchain mingw-w64-x86_64-python3-pip
    python3 -m pip install qmk

### macOS

Вам нужно будет установить Homebrew. Следуйте инструкциям на [домашней странице Homebrew](https://brew.sh).

После установки Homebrew выполните следующую команду:

    brew install qmk/qmk/qmk

### Linux

Вам нужно будет установить Git и Python. Скорее всего, они у вас уже есть, но если нет, одна из следующих команд должна установить их:

* Debian / Ubuntu / Devuan: `sudo apt install git python3 python3-pip`
* Fedora / Red Hat / CentOS: `sudo yum install git python3 python3-pip`
* Arch / Manjaro: `sudo pacman -S git python python-pip python-setuptools libffi`

Установите QMK CLI для дальнейшей настройки среды:

`python3 -m pip install --user qmk` (в дистрибутивах, основанных на Arch вы можете использовать пакет `qmk` из AUR (**примечание**: сопровождением пакета занимается один из членов сообщества): `yay -S qmk`)

## FreeBSD

Вам нужно будет установить Git и Python. Скорее всего, они у вас уже есть, но если нет, выполните следующую команду для их установки:

    pkg install git python3

Убедитесь, что `$HOME/.local/bin` добавлен в переменную `$PATH` для того, чтобы локально установленные пакеты Python были доступны.

Далее можно установить QMK CLI:

    python3 -m pip install --user qmk

## 3. Запутите QMK Setup :id=set-up-qmk

После установки QMK необходимо выполнить настройку, запустив эту команду:

    qmk setup

В большинстве случаев можно ответить Yes на все запросы.

?>**Примечание для Debian, Ubuntu и производных дистрибутивов**:
Возможно, вы столкнётесь с сообщением об ошибке: `bash: qmk: команда не найдена`.
Причина заключается в [баге](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=839155), появившемся в Debian вместе с Bash 4.4, когда `$HOME/.local/bin` был удалён из переменной PATH. В дальнейшем этот баг был исправлен в Debian и Ubuntu.
К сожалению, в Ubuntu он появился снова и [ещё не исправлен](https://bugs.launchpad.net/ubuntu/+source/bash/+bug/1588562).
Но исправить эту проблему можно легко. Запустите команду из-под своей учётной записи: `echo 'PATH="$HOME/.local/bin:$PATH"' >> $HOME/.bashrc && source $HOME/.bashrc`

?>**Примечание для FreeBSD**:
Предполагается, что вы запустите `qmk setup` из-под пользовательской учётной записи, а не `root`, но это скорее всего приведет к необходимости установки пакетов с использованием `pkg`. Эта установка завершится ошибкой из-за запуска в непривелигерованной учётной записи.
Для того, чтобы установить основные необходимые пакеты, выполните `./util/qmk_install.sh` из-под `root` или через `sudo`.
После завершения выполнения этого скрипта снова запустите `qmk setup`.

?> Если вы уже знаете, [как пользоваться GitHub](ru-ru/getting_started_github.md), мы рекомендуем создать собственный форк и воспользоваться командой `qmk setup <github_username>/qmk_firmware` для того, чтобы его клонировать. Если вы не знаете, что всё это означает, то можете просто игнорировать это примечание.

## 4. Протестируйте ваше окружение для сборки

Теперь, когда ваше окружение QMK для сборки настроено, вы можете собрать прошивку для вашей клавиатуры. Начните с попытки собрать стандартную раскладку для какой-либо клавиатуры. У вас должно это получиться с помощью следующей команды:

    qmk compile -kb <keyboard> -km default

Например, чтобы собрать прошивку для Clueboard 66%, вы используете:

    qmk compile -kb clueboard/66/rev3 -km default

Когда все закончится, вы должны увидеть большой лог, который заканчивается примерно так:

```
Linking: .build/clueboard_66_rev3_default.elf                                                       [OK]
Creating load file for flashing: .build/clueboard_66_rev3_default.hex                               [OK]
Copying clueboard_66_rev3_default.hex to qmk_firmware folder                                        [OK]
Checking file size of clueboard_66_rev3_default.hex                                                 [OK]
 * The firmware size is fine - 26356/28672 (2316 bytes free)
```

## Настройте вашу среду для сборки (опционально)

Вы можете настроить вашу среду, чтобы задать параметры по умолчанию и сделать работу с QMK менее утомительной. Приступим прямо сейчас!

У большинства начинающих есть только одна клавиатура. Можно сделать её клавиатурой по умолчанию при помощи команды `qmk config`. Пример для клавиатуры Clueboard66 ревизии 4:

    qmk config user.keyboard=clueboard/66/rev4

Можно назначить раскладку по умолчанию. Многие используют свой ник на GitHub, и мы рекомендуем поступить так же.

    qmk config user.keymap=<github_username>

В итоге вы сможете опустить дополнительные аргументы и компилировать прошивку следующей командой:

    qmk compile

# Создаем собственную раскладку

Теперь вы готовы создать свою персональную раскладку! Для этого перейдите к [Собираем вашу первую прошивку](ru-ru/newbs_building_firmware.md).
