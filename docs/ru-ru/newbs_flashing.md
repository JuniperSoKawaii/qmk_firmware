# Прошиваем клавиатуру

После успешной компиляции прошивки остаётся загрузить её в клавиатуру.

## Переведите клавиатуру в режим DFU (режим загрузчика)

Для того чтобы прошить клавиатуру её необходимо переключить в специальный режим прошивки (режим загрузчика). Во время нахождения в этом режиме клавиатуру нельзя будет использовать для набора текста. Очень важно не отключать клавиатуру или каким-либо ещё способом не прерывать процесс прошивки до его полного завершения.

Способ переключения в этот режим зависит от клавиатуры. Если в данный момент плата работает под управлением QMK, TMK или PS2AVRGB (Bootmapper Client) и у вас нет никаких дополнительных сведений, попробуйте следующее:

* Зажмите обе клавиши `Shift` и нажмите `Pause`
* Зажмите обе клавиши `Shift` и нажмите `B`
* Отключите клавиатуру, зажмите Пробел и `B`, подключите клавиатуру и подождите секунду отпустите клавиши
* Отключите клавиатуру, зажмите клавишу в левом верхнем или нижнем углу (обычно это Escape или левый Control) и подключите клавиатуру
* Нажмите физическую кнопку `RESET`. Обычно она находится на нижней стороне платы
* Найдите выводы на плате, обозначенные как `RESET` и `GND`. Замкните их и подключите клавиатуру.

Если всё вышеперечисленное не дало результата и основной чип платы имеет маркировку `STM32`, то процесс будет немного более сложным.
Лучше всего будет попросить помощи на [Discord](https://discord.gg/Uq7gcHh). С вас, скорее всего, попросят фотографии платы — приготовьте их заранее.

Если переключение произошло успешно, то QMK Toolbox вы увидите подобное сообщение, выделенное жёлтым цветом:

```
*** DFU device connected: Atmel Corp. ATmega32U4 (03EB:2FF4:0000)
```

Соответствующее устройство появится в Диспетчере устройств, System Information.app или выводе `lsusb`.

## Прошиваем клавиатуру при помощи QMK Toolbox

Самым простым способом прошить клавиатуру является использование [QMK Toolbox](https://github.com/qmk/qmk_toolbox/releases).

В настоящий момент Toolbox доступен только для Windows и macOS. Если вы используете Linux или хотите прошить клавиатуру из командной строки, перейдите в раздел «[Прошиваем клавиатуру из командной строки](#flash-your-keyboard-from-the-command-line)».

### Загружаем файл в QMK Toolbox

Запустите приложение QMK Toolbox. Для начала нужно найти, где лежит образ прошивки. Он может быть в двух форматах, `.hex` или `.bin`. QMK автоматически копирует нужный формат в корневой каталог QMK.

Наименование файла с прошивкой имеет следующий формат:

```
<имя_клавиатуры>_<имя_раскладки>.{bin,hex}
```

Например, прошивка для клавиатуры `planck/rev5` с раскладкой `default` будет называться так:

```
planck_rev5_default.hex
```

Перетащите найденный файл в «Local file» интерфейса QMK Toolbox или нажмите кнопку «Open» и укажите путь к файлу.

### Прошиваем клавиатуру

Нажмите `Flash` в QMK Toolbox. Вы подобное сообщение:

```
*** DFU device connected: Atmel Corp. ATmega32U4 (03EB:2FF4:0000)
*** Attempting to flash, please don't remove device
>>> dfu-programmer.exe atmega32u4 erase --force
    Erasing flash...  Success
    Checking memory from 0x0 to 0x6FFF...  Empty.
>>> dfu-programmer.exe atmega32u4 flash "D:\Git\qmk_firmware\gh60_satan_default.hex"
    Checking memory from 0x0 to 0x3F7F...  Empty.
    0%                            100%  Programming 0x3F80 bytes...
    [>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>]  Success
    0%                            100%  Reading 0x7000 bytes...
    [>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>]  Success
    Validating...  Success
    0x3F80 bytes written into 0x7000 bytes memory (56.70%).
>>> dfu-programmer.exe atmega32u4 reset

*** DFU device disconnected: Atmel Corp: ATmega32U4 (03EB:2FF4:0000)
```

## Прошиваем клавиатуру из командной строки

В настоящее время эта процедура существенно упростилась. Когда вы готовы скомпилировать и загрузить прошивку, просто наберите в терминале:

    qmk flash

Если наименование клавиатуры и прошивки по умолчанию не было задано или у вас несколько клавиатур, укажите дополнительные параметры:

    qmk flash -kb <my_keyboard> -km <my_keymap>

Команда проверит конфигурацию клавиатуры и попытается прошить её в соответствии с указанным загрузчиком. Это означает, что вам не нужно знать тип загрузчика, используемого клавиатурой. Если если информация о загрузчике отсутствует в конфигурации или плата имеет неподдерживаемый загрузчик, то вы увидите следующее сообщение об ошибке:

    WARNING: This board's bootloader is not specified or is not supported by the ":flash" target at this time.

В этом случае придётся оказать тип загрузчика вручную. См. раздел «[Загрузка прошивки](ru-ru/flashing.md)».

## Проверяем!

Поздравляем. Ваша прошивка был загружена в клавиатуру!

Убедитесь, что всё работает так, как вы планировали. В дополнение мы написали раздел «[Тестирование и отладка](newbs_testing_debugging.md)». Он рассказывает о том, как протестировать вашу прошивку и отладить дополнительный функционал.
