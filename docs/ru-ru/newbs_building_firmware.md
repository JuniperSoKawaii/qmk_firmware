# Создаём собственную раскладку

После настройки среды для сборки всё готово для сборки собственной прошивки. В этом разделе руководства мы будем переключаться между файловым менеджером, текстовым редактором и окном терминала.

## Создаём новую раскладку

Для создания собственной раскладки необходимо сделать копию раскладки `default`. Если вы настроили среду сборки, указав модель и ревизию клавиатуры по умолчанию, то это можно сделать при помощи QMK CLI:

    qmk new-keymap

Если среда не настроена или у вас есть несколько клавиатур, то укажите свою клавиатуру:

    qmk new-keymap -kb <keyboard_name>

Обратите внимание на вывод команды, вы должны увидеть что-то подобное:

    Ψ <github_username> keymap directory created in: /home/me/qmk_firmware/keyboards/clueboard/66/rev3/keymaps/<github_username>

Это будет путь к вашему файлу `keymap.c`.

## Открываем `keymap.c` в текстовом редакторе

Откройте ваш `keymap.c` в текстовом редакторе. В этом файле вы увидите структуру, контролирующую поведение вашей клавиатуры. В начале `keymap.c` вы увидите несколько объявлений для препроцессора (define) и перечислений (enum), повышающих удобство чтения. Дальше вы обнаружите вот такую строчку:

    const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

За ней следует список слоёв. Перед каждым слоем вы увидите строки, содержащие `LAYOUT` — это начало слоя. Далее будет следовать список кодов клавиш, находящихся на определённом слое.

!> Редактируя раскладку будьте внимательны, чтобы случайно не удалить или не добавить запятые. Если вы это сделаете, то прошивка не скомпилируется и найти источник ошибки будет непросто.

## Редактируем раскладку по своему вкусу

Порядок выполнения этого этапа — исключительно на ваше усмотрение. Можно вносить сначала небольшие необходимые изменения или полностью всё переписать. Вы можете удалить дополнительные слои, если они вам не нужны, или добавить ещё, вплоть до 32-х. QMK поддерживает большой объём функционала — полный список можно найти в меню слева, в разделе «Использование QMK». Для начала стоит ознакомиться с базовыми возможностями:

* [Основные коды клавиш](ru-ru/keycodes_basic.md)
* [Quantum-коды](ru-ru/quantum_keycodes.md)
* [Grave/Escape](ru-ru/feature_grave_esc.md)
* [Управление мышью](ru-ru/feature_mouse_keys.md)

?> До тех пор, пока вы полностью не разберётесь с тем, как работают раскладки, старайтесь вносить небольшие изменения. Большие правки затруднят диагностику возможных проблем.

## Компилируем прошивку :id=build-your-firmware

После внесения изменений в раскладку необходимо скомпилировать прошивку. Переключитесь в окно терминала и запустите компиляцию:

    qmk compile

Если у вас не настроены клавиатура и раскладка по умолчанию, или у вас несколько клавиатур, то вы можете указать клавиатуру и/или раскладку:

    qmk compile -kb <keyboard> -km <keymap>

Во время компиляции вы увидите большой объём логов, указывающих на то, какие именно файлы компилируются в данный момент. В конце вы должны увидеть приблизительно следующее:

```
Linking: .build/planck_rev5_default.elf                                                             [OK]
Creating load file for flashing: .build/planck_rev5_default.hex                                     [OK]
Copying planck_rev5_default.hex to qmk_firmware folder                                              [OK]
Checking file size of planck_rev5_default.hex                                                       [OK]
 * The firmware size is fine - 27312/28672 (95%, 1360 bytes free)
```

## Прошиваем клавиатуру

Перейдите в раздел «[Прошиваем файл прошивки](ru-ru/newbs_flashing.md)», посвящённый тому, как загрузить вашу прошивку в клавиатуру.
