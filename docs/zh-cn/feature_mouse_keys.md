# 鼠标键

<!---
  original document: 0.15.18:docs/feature_mouse_keys.md
  git diff 0.15.18 HEAD -- docs/feature_mouse_keys.md | cat
-->

鼠标键功能可以通过键盘来模拟鼠标操作，能够实现鼠标指针以任意速度进行移动，以及5种按键的点击和8个方向上的滚动功能。

*译注：在（Windows为主的）中文操作系统中，对于鼠标所控制的定位箭头，用词更多地采用“鼠标指针”，部分场合也会使用“光标”或“游标”。QMK文档中使用的术语直译为“光标”（cursor），为了与文本编辑环境中的会闪烁的文本插入光标作区分，也为了遵循已有用法，本篇中将使用“鼠标指针”或“指针”作为“cursor”的译法。*

*同时，为了行文顺畅，不再刻意区分滚轮“滚动距离”及指针“移动距离”，统一写为“移动距离”*

## 向你的键盘中添加鼠标键

若要使用鼠标键，必须先启用鼠标键功能并将鼠标动作映射到键盘的按键上。

### 启用鼠标键

要启用鼠标键功能，须添加如下代码至 `rules.mk` 文件中：

```c
MOUSEKEY_ENABLE = yes
```

### 映射鼠标操作

在键映射中可以使用如下键码将按键映射到鼠标操作上：

|键              |别名      |描述             |
|----------------|---------|-----------------|
|`KC_MS_UP`      |`KC_MS_U`|指针上移          |
|`KC_MS_DOWN`    |`KC_MS_D`|指针下移          |
|`KC_MS_LEFT`    |`KC_MS_L`|指针左移          |
|`KC_MS_RIGHT`   |`KC_MS_R`|指针右移          |
|`KC_MS_BTN1`    |`KC_BTN1`|点击按键1         |
|`KC_MS_BTN2`    |`KC_BTN2`|点击按键2         |
|`KC_MS_BTN3`    |`KC_BTN3`|点击按键3         |
|`KC_MS_BTN4`    |`KC_BTN4`|点击按键4         |
|`KC_MS_BTN5`    |`KC_BTN5`|点击按键5         |
|`KC_MS_BTN6`    |`KC_BTN6`|点击按键6         |
|`KC_MS_BTN7`    |`KC_BTN7`|点击按键7         |
|`KC_MS_BTN8`    |`KC_BTN8`|点击按键8         |
|`KC_MS_WH_UP`   |`KC_WH_U`|滚轮向上滚动       |
|`KC_MS_WH_DOWN` |`KC_WH_D`|滚轮向下滚动       |
|`KC_MS_WH_LEFT` |`KC_WH_L`|滚轮向左滚动       |
|`KC_MS_WH_RIGHT`|`KC_WH_R`|滚轮向右滚动       |
|`KC_MS_ACCEL0`  |`KC_ACL0`|设置速度到0档      |
|`KC_MS_ACCEL1`  |`KC_ACL1`|设置速度到1档      |
|`KC_MS_ACCEL2`  |`KC_ACL2`|设置速度到2档      |

## 配置鼠标键

鼠标键支持三种指针的移动模式：

* **加速式（默认）：** 按住指针移动键会逐渐加速，直至最大速度。
* **动力学式：** 按住指针移动键时会以二次函数曲线方式逐渐加速，直至最大速度。
* **固定式：** 按住指针移动键时以固定速度移动。
* **综合式：** 按住指针移动键会逐渐加速，直至最大速度，但同时按下速度键及指针移动键时则会以固定速度移动。

以上规则同样适用于滚动操作。

时长、间隔时间及延迟量配置参数都以毫秒为单位。滚动速度则以默认滚动距离的倍数为单位。例如，滚动速度为8意味着每次滚动距离为操作系统或应用指定的默认一次滚动的长度的8倍。

### 加速模式

此为默认模式。可以在键映射的 `config.h` 文件中使用下表内的参数来调整指针及滚动的加速度：

|定义                         |默认值 |描述                                                      |
|----------------------------|-------|---------------------------------------------------------|
|`MOUSEKEY_DELAY`            |300    |指针移动键点击与指针移动开始间的延迟                          |
|`MOUSEKEY_INTERVAL`         |50     |指针移动中的毫秒时间间隔                                    |
|`MOUSEKEY_MOVE_DELTA`       |5      |每次移动的距离/步进值                                       |
|`MOUSEKEY_MAX_SPEED`        |10     |指针移动速度的上限                                          |
|`MOUSEKEY_TIME_TO_MAX`      |20     |指针移动速度达到上限所需时长                                 |
|`MOUSEKEY_WHEEL_DELAY`      |300    |滚动键点击与滚动开始间的延迟                                 |
|`MOUSEKEY_WHEEL_INTERVAL`   |100    |滚动时的时间间隔                                           |
|`MOUSEKEY_WHEEL_MAX_SPEED`  |8      |每次滚动的最大滚动速度                                      |
|`MOUSEKEY_WHEEL_TIME_TO_MAX`|40     |滚动速度达到上限所需时长                                    |

提示：

* 若 `MOUSEKEY_DELAY` 设置过低会导致指针不响应操作，而设置过高则会导致短距离移动困难。
* 若要让移动更平滑，可以降低 `MOUSEKEY_INTERVAL` 值。若你的显示器刷新率为 60Hz，可以设置为 `16`（1/60），但由于这样会明显加大移动速度，可以对应地降低 `MOUSEKEY_MAX_SPEED` 值。
* 若将 `MOUSEKEY_TIME_TO_MAX` 或 `MOUSEKEY_WHEEL_TIME_TO_MAX` 设置为 `0` 则会禁用对应的加速功能，这样允许其中一个以固定速度移动，而另一个保留加速功能。这在固定速度模式下是无法做到的。
* 若 `MOUSEKEY_WHEEL_INTERVAL` 设置过低会导致滚动过快，而设置过高则会导致按下滚轮键时移动过慢。

指针的加速算法与 X Window 系统的 MouseKeysAccel 功能的一致，更多资料请[参阅维基百科](https://en.wikipedia.org/wiki/Mouse_keys)。

### 动力学模式

这是加速模式的一种扩展。该模式将二次函数曲线应用到加速度上，可以同时实现短距离内的精确移动和长距离的快速移动。可以在键映射的 `config.h` 文件中使用下表内的参数来调整指针及滚动的加速度：

|定义                                  |默认值    |描述                                  |
|--------------------------------------|---------|-------------------------------------|
|`MK_KINETIC_SPEED`                    |未定义    |启用动力学模式                         |
|`MOUSEKEY_DELAY`                      |8        |指针移动键点击与指针移动开始间的延迟       |
|`MOUSEKEY_INTERVAL`                   |8        |指针移动中的毫秒时间间隔                 |
|`MOUSEKEY_MOVE_DELTA`                 |25       |从初始速度到基准速度的加速步进值          |
|`MOUSEKEY_INITIAL_SPEED`              |100      |初始速度，单位为每秒移动过的像素数        |
|`MOUSEKEY_BASE_SPEED`                 |1000     |速度上限（基准速度）                    |
|`MOUSEKEY_DECELERATED_SPEED`          |400      |减速后的指针速度                       |
|`MOUSEKEY_ACCELERATED_SPEED`          |3000     |加速后的指针速度                       |
|`MOUSEKEY_WHEEL_INITIAL_MOVEMENTS`    |16       |滚轮初始移动量                         |
|`MOUSEKEY_WHEEL_BASE_MOVEMENTS`       |32       |滚轮最大移动量                         |
|`MOUSEKEY_WHEEL_ACCELERATED_MOVEMENTS`|48       |加速后的滚轮移动量                      |
|`MOUSEKEY_WHEEL_DECELERATED_MOVEMENTS`|8        |减速后的滚轮移动量                      |

提示：

* 指针的移动是否平滑取决于 `MOUSEKEY_INTERVAL` 设置，该时间间隔越小则移动越平滑。设置的过低会导致指针不响应操作，但若微处理器足够快则该值可以设置的更低。举例：若要每 `8` 毫秒移动一次，则应设置为每秒移动 `125` 次；速度上限设置为 `1000` 时，每次指针会移动 `8` 个像素。
* 滚轮滚动的实现与指针移动的不同。指针可以一次移动多个像素，但在滚轮上这么做只会混乱地（jerky）滚动。正确的做法是，将滚动量设置为 `1`，并按照每秒滚动距离设置滚动速度。

### 固定模式

该模式下可以对指针及滚轮分别设置若干个固定的速度，不会加速移动。`KC_ACL0`, `KC_ACL1` 以及 `KC_ACL2` 用于切换指针及滚轮速度至对应的设置值。

可以将速度值设置为临时模式或点击切换模式：

* **临时模式：** 仅在速度键被按住时才会激活对应的速度值。一旦松开速度键，速度值即恢复到常态。
* **点击切换模式：** 点击速度键后速度值即被设置为对应值，即便松开速度键也不会恢复。默认速度值为 `KC_ACL1`，且没有常态速度。

各速度值的默认值从小到大排序为：

* **临时模式：** `KC_ACL0` < `KC_ACL1` < *常态速度* < `KC_ACL2`
* **点击切换模式：** `KC_ACL0` < `KC_ACL1` < `KC_ACL2`

若要启用固定速度模式，须在 `config.h` 中至少定义 `MK_3_SPEED`：

```c
#define MK_3_SPEED
```

若要使用临时模式，须同时定义 `MK_MOMENTARY_ACCEL`：

```c
#define MK_MOMENTARY_ACCEL
```

若想调整指针或滚轮的移动速度，可以使用以下配置：

|定义                  |默认值       |描述                                        |
|---------------------|-------------|-------------------------------------------|
|`MK_3_SPEED`         |*未定义*      |启用固定速度模式                             |
|`MK_MOMENTARY_ACCEL` |*未定义*      |启用临时模式                                 |
|`MK_C_OFFSET_UNMOD`  |16           |指针单次移动距离（常态）                       |
|`MK_C_INTERVAL_UNMOD`|16           |指针移动时间间隔（常态）                       |
|`MK_C_OFFSET_0`      |1            |指针单次移动距离（`KC_ACL0`）                 |
|`MK_C_INTERVAL_0`    |32           |指针移动时间间隔（`KC_ACL0`）                 |
|`MK_C_OFFSET_1`      |4            |指针单次移动距离（`KC_ACL1`）                 |
|`MK_C_INTERVAL_1`    |16           |指针移动时间间隔（`KC_ACL1`）                 |
|`MK_C_OFFSET_2`      |32           |指针单次移动距离（`KC_ACL2`）                 |
|`MK_C_INTERVAL_2`    |16           |指针移动时间间隔（`KC_ACL2`）                 |
|`MK_W_OFFSET_UNMOD`  |1            |滚轮单次滚动距离（常态）                      |
|`MK_W_INTERVAL_UNMOD`|40           |滚轮滚动时间间隔（常态）                      |
|`MK_W_OFFSET_0`      |1            |滚轮单次滚动距离（`KC_ACL0`）                 |
|`MK_W_INTERVAL_0`    |360          |滚轮滚动时间间隔（`KC_ACL0`）                 |
|`MK_W_OFFSET_1`      |1            |滚轮单次滚动距离（`KC_ACL1`）                 |
|`MK_W_INTERVAL_1`    |120          |滚轮滚动时间间隔（`KC_ACL1`）                 |
|`MK_W_OFFSET_2`      |1            |滚轮单次滚动距离（`KC_ACL2`）                 |
|`MK_W_INTERVAL_2`    |20           |滚轮滚动时间间隔（`KC_ACL2`）                 |

### 综合模式

该模式类似于**加速模式**，可以按下 `KC_ACL0`, `KC_ACL1` 和 `KC_ACL2` （且按住时）临时地将指针及滚轮设置为固定速度。在没有按住速度键时，该模式将表现地与**加速模式**一致，且所有加速模式的参数此时都适用。

* **KC_ACL0:** 该速度档会将指针移动速度设置的尽量低，用于需要小幅度移动或需要高精度定位的场合。
* **KC_ACL1:** 该速度档会将移动速度设置为（用户定义的）最大速度值的一半。
* **KC_ACL2:** 该速度档会将移动速度设置为（电脑给定的）最大速度，用于在需要长距离移动且不要求精度的场合使用。

若要启用综合模式，须在 `config.h` 中至少定义 `MK_COMBINED`：

```c
#define MK_COMBINED
```

## 与 PS/2 鼠标及其它定位设备一同使用

鼠标键的状态是与 [PS/2 鼠标](zh-cn/feature_ps2_mouse.md)以及[定位设备](zh-cn/feature_pointing_device.md)共享的，因此鼠标键可以参与到点击及拖拽动作中。
