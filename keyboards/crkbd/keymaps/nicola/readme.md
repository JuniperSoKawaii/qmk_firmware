# crkbd用 親指シフトキーマップ (NICOLA配列)

Lacailleや、やまぶきRを使わずにキーボードのみで親指シフトするためのキーマップです。

## ビルド

ビルドの環境が整っている場合は、
```
make crkbd:nicola
```
Dockerを使ってビルドする場合は
```
docker build . -t qmk:debian
```
でイメージを作成してから、以下のようにビルドします。
```
docker run -e KEYBOARD=crkbd -e KEYMAP=nicola  --rm -v $('pwd'):/qmk_firmware:rw qmk:debian
```

## 使い方

英字入力用のQWERTYレイヤーと、親指シフト用のNICOLAレイヤーを切り替えて使い分けます。Macであれば最右列のQWERTYキーとNICOLAキーでレイヤー切り替えとOSの入力モードを同時に切り替えられます。NICOLAレイヤーかつ日本語入力モードにしたら、crkbdの左右の親指3キーのそれぞれ中央のキー(NLSHFT, NRSHFT)が親指シフトキーになります。

```
  [_QWERTY] = LAYOUT_kc( \
  //,-----------------------------------------.                ,-----------------------------------------.
        ESC,     Q,     W,     E,     R,     T,                      Y,     U,     I,     O,     P,  BSPC,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
      CTLTB,     A,     S,     D,     F,     G,                      H,     J,     K,     L,  SCLN,NICOLA,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
       LGUI,     Z,     X,     C,     V,     B,                      N,     M,  COMM,   DOT,  SLSH,QWERTY,\
  //|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
                                  LOWER,  LALT,   SPC,      ENT,  RSFT, RAISE \
                              //`--------------------'  `--------------------'
  ),

  [_NICOLA] = LAYOUT_kc( \
  //,-----------------------------------------.                ,-----------------------------------------.
        ESC,     Q,     W,     E,     R,     T,                      Y,     U,     I,     O,     P,  BSPC,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
      CTLTB,     A,     S,     D,     F,     G,                      H,     J,     K,     L,  SCLN,NICOLA,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
       LGUI,     Z,     X,     C,     V,     B,                      N,     M,  COMM,   DOT,  SLSH,QWERTY,\
  //|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
                                  LOWER,NLSHFT,   SPC,      ENT,NRSHFT, RAISE \
                              //`--------------------'  `--------------------'
  ),
```

## 既知の問題点

- crkbdにそのままコードを追加するとファームウエアの最大容量を超えるため、RGBLIGHT_ENABLE = no にしています。
- ~~NICOLAレイヤーでのCMDキーやOPTIONキーの動作は未実装です。期待した動作になりません。~~ 実装しました。

## 実装方法

基本的にはキーリリースのタイミングで同時押しを判定しています。加えて2文字目のキープレスでも同時判定しています。
~~また、シフトキーを押したままの連続シフトはしないようにしています。
連続シフトすると早く入力した時に意図しない入力結果になったためです。~~ 別のバグでした。
