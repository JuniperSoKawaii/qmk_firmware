# crkbd用 親指シフトキーマップ (NICOLA配列)

Lacailleや、やまぶきRを使わずにキーボードのみで親指シフトするためのキーマップです。

## ビルド

ビルドの環境が整っている場合は、
```
make crkbd:nicola
```
Dockerを使ってビルドする場合は
```
docker build . -t qmk:debian
```
でイメージを作成してから、以下のようにビルドします。
```
docker run -e KEYBOARD=crkbd -e KEYMAP=nicola  --rm -v $('pwd'):/qmk_firmware:rw qmk:debian
```

## 使い方

英字入力用のQWERTYレイヤーと、親指シフト用のNICOLAレイヤーを切り替えて使い分けます。MacではRAISEキーの単押しで日本語入力へ、LOWERキーで英字入力へ切り替えられます(参考 http://okapies.hateblo.jp/entry/2019/02/02/133953 )。日本語入力ではcrkbdの左右の親指3キーのそれぞれ中央のキー(NLSHFT, NRSHFT)が親指シフトキーになります。EUCA LYN配列への切り替えもサポートしました(ADJUST+D、EUCALYN配列の時のE)

```
  [_QWERTY] = LAYOUT_kc( \
  //,-----------------------------------------.                ,-----------------------------------------.
        ESC,     Q,     W,     E,     R,     T,                      Y,     U,     I,     O,     P,  BSPC,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
      CTLTB,     A,     S,     D,     F,     G,                      H,     J,     K,     L,  SCLN,  RGUI,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
       LSFT,     Z,     X,     C,     V,     B,                      N,     M,  COMM,   DOT,  SLSH,  RALT,\
  //|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
                                  LOWER,  LSFT,   SPC,      ENT,  RSFT, RAISE \
                              //`--------------------'  `--------------------'
  ),

  [_NICOLA] = LAYOUT_kc( \
  //,-----------------------------------------.                ,-----------------------------------------.
      _____,     Q,     W,     E,     R,     T,                      Y,     U,     I,     O,     P, _____,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
      _____,     A,     S,     D,     F,     G,                      H,     J,     K,     L,  SCLN, _____,\
  //|------+------+------+------+------+------|                |------+------+------+------+------+------|
      _____,     Z,     X,     C,     V,     B,                      N,     M,  COMM,   DOT,  SLSH, _____,\
  //|------+------+------+------+------+------+------|  |------+------+------+------+------+------+------|
                                  _____,NLSHFT, _____,    _____,NRSHFT, _____ \
                              //`--------------------'  `--------------------'
  ),
```

## 既知の問題点

- crkbdにそのままコードを追加するとファームウエアの最大容量を超えるため、RGBLIGHT_ENABLE = no にしています。
- ~~NICOLAレイヤーでのCMDキーやOPTIONキーの動作は未実装です。期待した動作になりません。~~ 実装しました。

## 実装方法

基本的にはキーリリースのタイミングで同時押しを判定しています。加えて2文字目のキープレスでも同時判定しています。
~~また、シフトキーを押したままの連続シフトはしないようにしています。
連続シフトすると早く入力した時に意図しない入力結果になったためです。~~ 別のバグでした。
